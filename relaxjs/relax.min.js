function t(t,n){const{class:o,style:s,...i}=n;delete i.key,o&&function(t,e){t.className="","string"==typeof e&&(t.className=e);Array.isArray(e)&&t.classList.add(...e)}(t,o),s&&Object.entries(s).forEach((([e,n])=>{r(t,e,n)}));for(const[n,r]of Object.entries(i))e(t,n,r)}function e(t,e,r){null==r?n(t,e):e.startsWith("data-")?t.setAttribute(e,r):t[e]=r}function n(t,e){try{t[e]=null}catch{console.warn(`Failed to set "${e}" to null on ${t.tagName}`)}t.removeAttribute(e)}function r(t,e,n){t.style[e]=n}function o(t,e){t.style[e]=null}function s(t,e,n,r=null){function o(){r?e.apply(r,arguments):e(...arguments)}return n.addEventListener(t,o),o}function i(t){const e=new Map;for(const n of t)e.set(n,(e.get(n)||0)+1);return e}function c(t){return t.filter((t=>null!=t))}function a(t,e){const n=i(t),r=i(e),o=function(t,e){const n=Array.from(t.keys()),r=Array.from(e.keys());return{added:r.filter((e=>!t.has(e))),removed:n.filter((t=>!e.has(t))),updated:r.filter((n=>t.has(n)&&t.get(n)!==e.get(n)))}}(n,r),s=o.added.flatMap((t=>Array(r.get(t)).fill(t))),c=o.removed.flatMap((t=>Array(n.get(t)).fill(t)));for(const t of o.updated){const e=n.get(t),o=r.get(t)-e;o>0?s.push(...Array(o).fill(t)):c.push(...Array(-o).fill(t))}return{added:s,removed:c}}const l="add",u="remove",f="move",h="noop";class d{#t=[];#e=[];#n;constructor(t,e){this.#t=[...t],this.#e=t.map(((t,e)=>e)),this.#n=e}get length(){return this.#t.length}originalIndexAt(t){return this.#e[t]}findIndexFrom(t,e){for(let n=e;n<this.length;n++)if(this.#n(t,this.#t[n]))return n;return-1}isRemoval(t,e){if(t>=this.length)return!1;const n=this.#t[t];return-1===e.findIndex((t=>this.#n(n,t)))}removeItem(t){const e={op:u,index:t,item:this.#t[t]};return this.#t.splice(t,1),this.#e.splice(t,1),e}isNoop(t,e){if(t>=this.length)return!1;const n=this.#t[t],r=e[t];return this.#n(n,r)}noopItem(t){return{op:h,index:t,originalIndex:this.originalIndexAt(t),item:this.#t[t]}}isAddition(t,e){return-1===this.findIndexFrom(t,e)}addItem(t,e){const n={op:l,index:e,item:t};return this.#t.splice(e,0,t),this.#e.splice(e,0,-1),n}moveItem(t,e){const n=this.findIndexFrom(t,e),r={op:f,originalIndex:this.originalIndexAt(n),from:n,index:e,item:this.#t[n]},[o]=this.#t.splice(n,1);this.#t.splice(e,0,o);const[s]=this.#e.splice(n,1);return this.#e.splice(e,0,s),r}removeItemsAfter(t){const e=[];for(;this.length>t;)e.push(this.removeItem(t));return e}}function p(t,e="Assertion failed"){if(!t)throw new Error(e)}const m={TEXT:"text",ELEMENT:"element",FRAGMENT:"fragment",COMPONENT:"component",SLOT:"slot"};function y(t,e={},n=[]){const r="string"==typeof t?m.ELEMENT:m.COMPONENT;return p("object"==typeof e&&!Array.isArray(e),"[vdom] h() expects an object as props (2nd argument)"),p(Array.isArray(n),`[vdom] h() expects an array of children (3rd argument), but got '${typeof n}'`),{tag:t,props:e,type:r,children:M(c(n))}}function E({tag:t}){return"function"==typeof t}function v(t){return{type:m.TEXT,value:String(t)}}function g(t){return p(Array.isArray(t),"[vdom] hFragment() expects an array of vNodes"),{type:m.FRAGMENT,children:M(c(t))}}let b=!1;function O(t=[]){return b=!0,{type:m.SLOT,children:t}}function M(t){return t.map((t=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"bigint"==typeof t||"symbol"==typeof t?v(t):t))}function w(t){if(null==t.children)return[];const e=[];for(const n of t.children)n.type===m.FRAGMENT?e.push(...w(n)):e.push(n);return e}let N=!1;const T=[];function A(t){T.push(t),x()}function x(){N||(N=!0,queueMicrotask(I))}function I(){for(;T.length>0;){const t=T.shift()();Promise.resolve(t).then((()=>{}),(t=>{console.error(`[scheduler]: ${t}`)}))}N=!1}function k(){return x(),new Promise((t=>setTimeout(t)))}function C(t){const{on:e={},...n}=t.props;return delete n.key,{props:n,events:e}}function P(e,n,r,o=null){if(null==n)throw new Error("[mountDOM] Parent element is null");switch(e.type){case m.TEXT:!function(t,e,n){const{value:r}=t,o=document.createTextNode(r);t.el=o,j(o,e,n)}(e,n,r);break;case m.ELEMENT:!function(e,n,r,o){const{tag:i,children:c}=e,a=document.createElement(i);(function(e,n,r){const{props:o,events:i}=C(n);n.listeners=function(t={},e,n=null){const r={};return Object.entries(t).forEach((([t,o])=>{const i=s(t,o,e,n);r[t]=i})),r}(i,e,r),t(e,o)})(a,e,o),e.el=a,c.forEach((t=>P(t,a,null,o))),j(a,n,r)}(e,n,r,o);break;case m.FRAGMENT:!function(t,e,n,r){const{children:o}=t;t.el=e;for(const t of o)if(P(t,e,n,r),null!=n)switch(t.type){case m.FRAGMENT:n+=t.children.length;break;case m.COMPONENT:n+=t.component.elements.length;break;default:n++}}(e,n,r,o);break;case m.COMPONENT:!function(t,e,n,r){const{tag:o,children:s}=t,{props:i,events:c}=C(t),a=new o(i,c,r);a.setExternalContent(s),a.mount(e,n),t.component=a,t.el=a.firstElement}(e,n,r,o),A((()=>e.component.onMounted()));break;default:throw new Error(`Can't mount DOM of type: ${e.type}`)}}function j(t,e,n){if(null==n)return void e.append(t);if(n<0)throw new Error(`Index must be a positive integer, got ${n}`);const r=e.childNodes;n>=r.length?e.append(t):e.insertBefore(t,r[n])}function F(t){const{type:e}=t;switch(e){case m.TEXT:!function(t){const{el:e}=t;p(e instanceof Text),e.remove()}(t);break;case m.ELEMENT:!function(t){const{el:e,children:n,listeners:r}=t;p(e instanceof HTMLElement),e.remove(),n.forEach(F),r&&(!function(t={},e){Object.entries(t).forEach((([t,n])=>{e.removeEventListener(t,n)}))}(r,e),delete t.listeners)}(t);break;case m.FRAGMENT:!function(t){const{children:e}=t;e.forEach(F)}(t);break;case m.COMPONENT:t.component.unmount(),A((()=>t.component.onUnmounted()));break;default:throw new Error(`Can't destroy DOM of type: ${e}`)}delete t.el}function L(t,e={}){let n=null,r=!1,o=null;return{mount(s){if(r)throw new Error("The application is already mounted");n=s,o=y(t,e),P(o,n),r=!0},unmount(){if(!r)throw new Error("The application is not mounted");F(o),n=null,r=!1,o=null}}}function H(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var S,R;var $=(R||(R=1,S=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var r,o,s;if(Array.isArray(e)){if((r=e.length)!=n.length)return!1;for(o=r;0!=o--;)if(!t(e[o],n[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((r=(s=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(o=r;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,s[o]))return!1;for(o=r;0!=o--;){var i=s[o];if(!t(e[i],n[i]))return!1}return!0}return e!=e&&n!=n}),S),G=H($);class q{#r=new Map;#o=[];subscribe(t,e){this.#r.has(t)||this.#r.set(t,[]);const n=this.#r.get(t);return n.includes(e)?()=>{}:(n.push(e),()=>{const t=n.indexOf(e);n.splice(t,1)})}afterEveryCommand(t){return this.#o.push(t),()=>{const e=this.#o.indexOf(t);this.#o.splice(e,1)}}dispatch(t,e){this.#r.has(t)?this.#r.get(t).forEach((t=>t(e))):console.warn(`No handlers for command: ${t}`),this.#o.forEach((t=>t()))}}function X(t,e){if(t.type!==e.type)return!1;if(t.type===m.ELEMENT){const{tag:n,props:{key:r}}=t,{tag:o,props:{key:s}}=e;return n===o&&r===s}if(t.type===m.COMPONENT){const{tag:n,props:{key:r}}=t,{tag:o,props:{key:s}}=e;return n===o&&r===s}return!0}function D(t,e){const n=Object.keys(t),r=Object.keys(e);return{added:r.filter((e=>!(e in t))),removed:n.filter((t=>!(t in e))),updated:r.filter((n=>n in t&&t[n]!==e[n]))}}function U(t){return function(t){return""!==t}(t.trim())}function B(t,i,c,p=null){if(!X(t,i)){const e=function(t,e){const n=Array.from(t.childNodes).indexOf(e);if(n<0)return null;return n}(c,t.el);return F(t),P(i,c,e,p),i}switch(i.el=t.el,i.type){case m.TEXT:return function(t,e){const n=t.el,{value:r}=t,{value:o}=e;r!==o&&(n.nodeValue=o)}(t,i),i;case m.ELEMENT:!function(t,i,c){const l=t.el,{class:u,style:f,on:h,...d}=t.props,{class:p,style:m,on:y,...E}=i.props,{listeners:v}=t;(function(t,r,o){const{added:s,removed:i,updated:c}=D(r,o);for(const e of i)n(t,e);for(const n of s.concat(c))e(t,n,o[n])})(l,d,E),function(t,e,n){const r=_(e),o=_(n),{added:s,removed:i}=a(r,o);i.length>0&&t.classList.remove(...i);s.length>0&&t.classList.add(...s)}(l,u,p),function(t,e={},n={}){const{added:s,removed:i,updated:c}=D(e,n);for(const e of i)o(t,e);for(const e of s.concat(c))r(t,e,n[e])}(l,f,m),i.listeners=function(t,e={},n={},r={},o){const{removed:i,added:c,updated:a}=D(n,r);for(const n of i.concat(a))t.removeEventListener(n,e[n]);const l={};for(const e of c.concat(a)){const n=s(e,r[e],t,o);l[e]=n}return l}(l,v,h,y,c)}(t,i,p);break;case m.COMPONENT:!function(t,e){const{component:n}=t,{children:r}=e,{props:o}=C(e);n.setExternalContent(r),n.updateProps(o),e.component=n,e.el=n.firstElement}(t,i)}return function(t,e,n){const r=w(t),o=w(e),s=t.el,i=function(t,e,n=(t,e)=>t===e){const r=[],o=new d(t,n);for(let t=0;t<e.length;t++){if(o.isRemoval(t,e)){r.push(o.removeItem(t)),t--;continue}if(o.isNoop(t,e)){r.push(o.noopItem(t));continue}const n=e[t];o.isAddition(n,t)?r.push(o.addItem(n,t)):r.push(o.moveItem(n,t))}return r.push(...o.removeItemsAfter(e.length)),r}(r,o,X);for(const t of i){const{originalIndex:e,index:i,item:c}=t,a=n?.offset??0;switch(t.op){case l:P(c,s,i+a,n);break;case u:F(c);break;case f:{const t=r[e],c=o[i],l=s.childNodes[i+a];(E(t)?t.component.elements:[t.el]).forEach((e=>{s.insertBefore(e,l),B(t,c,s,n)}));break}case h:B(r[e],o[i],s,n)}}}(t,i,p),i}function _(t=""){return Array.isArray(t)?t.filter(U):t.split(/(\s+)/).filter(U)}function V(t,e,n=()=>!1,r=null,o=null){n(t)||(e(t,r,o),t.children&&t.children.forEach(((r,o)=>V(r,e,n,t,o))))}function W(t,e=[]){V(t,(function(t,n,r){!function(t,e,n,r){if(t.type!==m.SLOT)return;p(null!==e,"Slot nodes must have a parent"),p(null!==n,"Slot nodes must have an index");const o=t.children,s=r.length>0?r:o;p(Array.isArray(s),"Slot views must be an array");s.length>0?e.children.splice(n,1,g(s)):e.children.splice(n,1)}(t,n,r,e)}),z)}function z(t){return t.type===m.COMPONENT}const J=()=>{};function K({render:t,state:e,onMounted:n=J,onUnmounted:r=J,...o}){class s{#s=!1;#i=null;#c=null;#a=null;#l=null;#u=new q;#f=[];#h=[];constructor(t={},n={},r=null){this.props=t,this.state=e?e(t):{},this.#a=n,this.#l=r}onMounted(){return Promise.resolve(n.call(this))}onUnmounted(){return Promise.resolve(r.call(this))}get parentComponent(){return this.#l}get vdom(){return this.#i}get elements(){return null==this.#i?[]:this.#i.type===m.FRAGMENT?w(this.#i).flatMap((t=>t.type===m.COMPONENT?t.component.elements:[t.el])):[this.#i.el]}get firstElement(){return this.elements[0]}get offset(){return this.#i.type===m.FRAGMENT?Array.from(this.#c.children).indexOf(this.firstElement):0}updateProps(t){const e={...this.props,...t};G(this.props,e)||(this.props=e,this.#d())}updateState(t){this.state={...this.state,...t},this.#d()}setExternalContent(t){this.#h=t}render(){const e=t.call(this);return b&&(W(e,this.#h),b=!1),e}mount(t,e=null){if(this.#s)throw new Error("Component is already mounted");this.#i=this.render(),P(this.#i,t,e,this),this.#p(),this.#s=!0,this.#c=t}#p(){this.#f=Object.entries(this.#a).map((([t,e])=>this.#m(t,e)))}#m(t,e){return this.#u.subscribe(t,(t=>{this.#l?e.call(this.#l,t):e(t)}))}unmount(){if(!this.#s)throw new Error("Component is not mounted");F(this.#i),this.#f.forEach((t=>t())),this.#i=null,this.#s=!1,this.#c=null,this.#f=[]}emit(t,e){this.#u.dispatch(t,e)}#d(){if(!this.#s)throw new Error("Component is not mounted");const t=this.render();this.#i=B(this.#i,t,this.#c,this)}}for(const t in o){if(i=s,c=t,Object.prototype.hasOwnProperty.call(i,c))throw new Error(`Method "${t}()" already exists in the component. Can't override existing methods.`);s.prototype[t]=o[t]}var i,c;return s}export{m as DOM_TYPES,L as createApp,K as defineComponent,y as h,g as hFragment,O as hSlot,v as hString,k as nextTick};
